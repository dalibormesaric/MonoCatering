
@{
    ViewBag.Title = "CharUser";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>CharUser</h2>

<div>
    <h4>Form</h4>
    <br /><input type="text" id="message" placeholder="Message" size="100" />
    <br />
    <input type="button" id="sendToRestaurants" class="btn" value="Send to restaurants" />
</div>
<div>
    <h4>Messages</h4>
    <ul id="messages"></ul>
</div>

@section Scripts { 
    <script src="~/Scripts/jquery.signalR-2.0.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <script>
        function writeError(line) {
            var messages = $("#messages");
            messages.append("<li style='color:red;'>" + getTimeString() + ' ' + line + "</li>");
        }

        function writeLine(line) {
            var messages = $("#messages");
            messages.append("<li style='color:black;'>" + getTimeString() + ' ' + line + "</li>");
        }

        function getTimeString() {
            var currentTime = new Date();
            return currentTime.toTimeString();
        }

        $(function () {
            var connection = $.connection.hub,
                hub = $.connection.chatHub;

            connection.logging = true;

            hub.client.message = function (value) {
                writeLine(value);
            }

            connection.start()
                .done(function () {
                    writeLine("connected");
                })
                .fail(function (error) {
                    writeError(value);
                });

            $("#sendToRestaurants").click(function () {
                hub.server.sendToGroupRestaurant($("#message").val());
            });           

        });
    </script>
}