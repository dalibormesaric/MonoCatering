
@{
    ViewBag.Title = "ChatRestaurant";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>ChatRestaurant</h2>

<div>
    <h4>To a user</h4>
    <input type="text" id="message" placeholder="Message" size="100" />
    <br /><input type="text" id="userId" placeholder="User" size="100" />
    <br />
    <input type="button" id="sendToUser" class="btn" value="Send to specified userId" />
</div>
<div>
    <h4>Received Messages</h4>
    <ul id="messages"></ul>
</div>

@section Scripts {
    <script src="~/Scripts/jquery.signalR-2.0.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <script>
        function writeError(line) {
            var messages = $("#messages");
            messages.append("<li style='color:red;'>" + getTimeString() + ' ' + line + "</li>");
        }

        function writeLine(line) {
            var messages = $("#messages");
            messages.append("<li style='color:black;'>" + getTimeString() + ' ' + line + "</li>");
        }

        function getTimeString() {
            var currentTime = new Date();
            return currentTime.toTimeString();
        }

        $(function () {
            var connection = $.connection.hub,
                hub = $.connection.chatHub;

            connection.logging = true;

            hub.client.hubMessage = function (data) {
                writeLine("hubMessage: " + data);
            }

            connection.start()
                .done(function () {
                    writeLine("connected");
                    hub.server.joinGroupRestaurant();
                })
                .fail(function (error) {
                    writeError(value);
                });

            $("#sendToUser").click(function () {
                hub.server.sendToUser( $("#userId").val(), $("#message").val());
            });
        });
    </script>
}
